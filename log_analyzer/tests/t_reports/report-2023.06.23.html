
<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>rbui log analysis report</title>
    <meta name="description" content="rbui log analysis report">
    <style type="text/css">
        html, body {
            background-color: black;
        }

        th {
            text-align: center;
            color: silver;
            font-weight: 700;
            padding: 5px;
            cursor: pointer;
        }

        table {
            width: auto;
            border-collapse: collapse;
            margin: 1%;
            color: silver;
        }

        td {
            text-align: right;
            font-size: 1.1em;
            padding: 5px;
        }

        .report-table-body-cell-url {
            text-align: left;
            width: 20%;
        }

        .clipped {
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden !important;
            max-width: 700px;
            word-wrap: break-word;
            display: inline-block;
        }

        .url {
            cursor: pointer;
            color: #729FCF;
        }

        .alert {
            color: red;
        }
    </style>
</head>

<body>
<table border="1" class="report-table">
    <thead>
    <tr class="report-table-header-row">
    </tr>
    </thead>
    <tbody class="report-table-body">
    </tbody>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="jquery.tablesorter.min.js"></script>
    <script type="text/javascript">
        !function ($) {
            let table = [{'url': '/agency/campaigns/6403173/banners/bulk_read/', 'count': 1, 'count_perc': 1.0, 'time_sum': 8.019, 'time_perc': 12.506, 'time_avg': 8.019, 'time_max': 8.019, 'time_med': 8.019}, {'url': '/agency/campaigns/5399816/banners/bulk_read/', 'count': 1, 'count_perc': 1.0, 'time_sum': 5.027, 'time_perc': 7.84, 'time_avg': 5.027, 'time_max': 5.027, 'time_med': 5.027}, {'url': '/campaigns/7854358/banners/?', 'count': 1, 'count_perc': 1.0, 'time_sum': 4.684, 'time_perc': 7.305, 'time_avg': 4.684, 'time_max': 4.684, 'time_med': 4.684}, {'url': '/api/v2/slot/4847/groups', 'count': 1, 'count_perc': 1.0, 'time_sum': 3.573, 'time_perc': 5.572, 'time_avg': 3.573, 'time_max': 3.573, 'time_med': 3.573}, {'url': '/campaigns/7272511/banners/', 'count': 1, 'count_perc': 1.0, 'time_sum': 2.368, 'time_perc': 3.693, 'time_avg': 2.368, 'time_max': 2.368, 'time_med': 2.368}, {'url': '/api/v2/banner/26656130', 'count': 1, 'count_perc': 1.0, 'time_sum': 2.126, 'time_perc': 3.316, 'time_avg': 2.126, 'time_max': 2.126, 'time_med': 2.126}, {'url': '/api/v2/banner/26620959', 'count': 1, 'count_perc': 1.0, 'time_sum': 2.067, 'time_perc': 3.224, 'time_avg': 2.067, 'time_max': 2.067, 'time_med': 2.067}, {'url': '/api/v2/banner/26656286', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.57, 'time_perc': 2.448, 'time_avg': 1.57, 'time_max': 1.57, 'time_med': 1.57}, {'url': '/api/v2/banner/794333', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.546, 'time_perc': 2.411, 'time_avg': 1.546, 'time_max': 1.546, 'time_med': 1.546}, {'url': '/api/v2/banner/26633880', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.436, 'time_perc': 2.239, 'time_avg': 1.436, 'time_max': 1.436, 'time_med': 1.436}, {'url': '/api/v2/banner/26652137', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.386, 'time_perc': 2.162, 'time_avg': 1.386, 'time_max': 1.386, 'time_med': 1.386}, {'url': '/api/v2/banner/20347138', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.25, 'time_perc': 1.949, 'time_avg': 1.25, 'time_max': 1.25, 'time_med': 1.25}, {'url': '/agency/campaigns/5370439/banners/bulk_read/', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.236, 'time_perc': 1.928, 'time_avg': 1.236, 'time_max': 1.236, 'time_med': 1.236}, {'url': '/api/v2/banner/787365', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.204, 'time_perc': 1.878, 'time_avg': 1.204, 'time_max': 1.204, 'time_med': 1.204}, {'url': '/api/v2/banner/26616315', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.152, 'time_perc': 1.797, 'time_avg': 1.152, 'time_max': 1.152, 'time_med': 1.152}, {'url': '/api/v2/banner/794750', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.142, 'time_perc': 1.781, 'time_avg': 1.142, 'time_max': 1.142, 'time_med': 1.142}, {'url': '/api/v2/banner/1768270', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.077, 'time_perc': 1.68, 'time_avg': 1.077, 'time_max': 1.077, 'time_med': 1.077}, {'url': '/api/v2/banner/21279864', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.058, 'time_perc': 1.65, 'time_avg': 1.058, 'time_max': 1.058, 'time_med': 1.058}, {'url': '/api/v2/banner/25047662', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.051, 'time_perc': 1.639, 'time_avg': 1.051, 'time_max': 1.051, 'time_med': 1.051}, {'url': '/api/v2/banner/26614593', 'count': 1, 'count_perc': 1.0, 'time_sum': 1.017, 'time_perc': 1.586, 'time_avg': 1.017, 'time_max': 1.017, 'time_med': 1.017}];
            let reportDates;
            let columns = new Array();
            let lastRow = 150;
            let $table = $(".report-table-body");
            let $header = $(".report-table-header-row");
            let $selector = $(".report-date-selector");

            $(document).ready(function () {
                $(window).bind("scroll", bindScroll);
                const row = table[0];
                for (let k in row) {
                    columns.push(k);
                }
                columns = columns.sort();
                columns = columns.slice(columns.length - 1, columns.length).concat(columns.slice(0, columns.length - 1));
                drawColumns();
                drawRows(table.slice(0, lastRow));
                $(".report-table").tablesorter();
            });

            function drawColumns() {
                for (let i = 0; i < columns.length; i++) {
                    let $th = $("<th></th>").text(columns[i])
                        .addClass("report-table-header-cell")
                    $header.append($th);
                }
            }

            function drawRows(rows) {
                for (let i = 0; i < rows.length; i++) {
                    let row = rows[i];
                    let $row = $("<tr></tr>").addClass("report-table-body-row");
                    for (let j = 0; j < columns.length; j++) {
                        let columnName = columns[j];
                        let $cell = $("<td></td>").addClass("report-table-body-cell");
                        if (columnName == "url") {
                            const url = "https://rb.mail.ru" + row[columnName];
                            const $link = $("<a></a>").attr("href", url)
                                .attr("title", url)
                                .attr("target", "_blank")
                                .addClass("clipped")
                                .addClass("url")
                                .text(row[columnName]);
                            $cell.addClass("report-table-body-cell-url");
                            $cell.append($link);
                        } else {
                            $cell.text(row[columnName]);
                            if (columnName == "time_avg" && row[columnName] > 0.9) {
                                $cell.addClass("alert");
                            }
                        }
                        $row.append($cell);
                    }
                    $table.append($row);
                }
                $(".report-table").trigger("update");
            }

            function bindScroll() {
                if ($(window).scrollTop() == $(document).height() - $(window).height()) {
                    if (lastRow < 1000) {
                        drawRows(table.slice(lastRow, lastRow + 50));
                        lastRow += 50;
                    }
                }
            }

        }(window.jQuery)
    </script>
</table>
</body>
</html>